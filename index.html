<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Breathe</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-color: #050508;
            --bg-gradient: radial-gradient(ellipse at 50% 0%, rgba(25, 25, 40, 0.5) 0%, transparent 50%),
                          radial-gradient(ellipse at 50% 100%, rgba(15, 20, 30, 0.3) 0%, transparent 40%),
                          linear-gradient(180deg, #080810 0%, #0a0a12 50%, #060608 100%);
            --nav-bg: rgba(15, 15, 25, 0.6);
            --nav-border: rgba(255, 255, 255, 0.06);
            --nav-glow: rgba(255, 255, 255, 0.02);
            --text-color: rgba(255, 255, 255, 0.87);
            --text-muted: rgba(255, 255, 255, 0.45);
            --border-color: rgba(255, 255, 255, 0.08);
            --control-bg: rgba(255, 255, 255, 0.03);
            --control-hover: rgba(255, 255, 255, 0.06);
        }

        [data-theme="light"] {
            --bg-color: #f8f8f6;
            --bg-gradient: radial-gradient(ellipse at 50% 0%, rgba(255, 255, 255, 0.8) 0%, transparent 50%),
                          radial-gradient(ellipse at 50% 100%, rgba(230, 230, 225, 0.5) 0%, transparent 40%),
                          linear-gradient(180deg, #fafaf8 0%, #f4f4f2 50%, #eeeee8 100%);
            --nav-bg: rgba(255, 255, 255, 0.7);
            --nav-border: rgba(0, 0, 0, 0.06);
            --nav-glow: rgba(255, 255, 255, 0.5);
            --text-color: rgba(20, 20, 30, 0.87);
            --text-muted: rgba(20, 20, 30, 0.45);
            --border-color: rgba(0, 0, 0, 0.08);
            --control-bg: rgba(0, 0, 0, 0.03);
            --control-hover: rgba(0, 0, 0, 0.06);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-gradient);
            background-color: var(--bg-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.5s ease;
            overflow: hidden;
        }

        /* Navbar - Premium 3D Glassmorphism */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 14px 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(
                180deg,
                rgba(255, 255, 255, 0.08) 0%,
                rgba(255, 255, 255, 0.02) 50%,
                rgba(0, 0, 0, 0.05) 100%
            ), var(--nav-bg);
            backdrop-filter: blur(50px) saturate(200%);
            -webkit-backdrop-filter: blur(50px) saturate(200%);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            border-bottom: 1px solid rgba(0, 0, 0, 0.2);
            box-shadow:
                0 1px 0 0 rgba(255, 255, 255, 0.05) inset,
                0 -1px 0 0 rgba(0, 0, 0, 0.1) inset,
                0 4px 16px -4px rgba(0, 0, 0, 0.25),
                0 8px 32px -8px rgba(0, 0, 0, 0.15);
            z-index: 100;
            opacity: 0.92;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .navbar:hover {
            opacity: 1;
            box-shadow:
                0 1px 0 0 rgba(255, 255, 255, 0.08) inset,
                0 -1px 0 0 rgba(0, 0, 0, 0.1) inset,
                0 6px 20px -4px rgba(0, 0, 0, 0.3),
                0 12px 40px -8px rgba(0, 0, 0, 0.2);
        }

        [data-theme="light"] .navbar {
            background: linear-gradient(
                180deg,
                rgba(255, 255, 255, 0.9) 0%,
                rgba(255, 255, 255, 0.7) 50%,
                rgba(240, 240, 235, 0.8) 100%
            );
            border-top: 1px solid rgba(255, 255, 255, 0.8);
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
            box-shadow:
                0 1px 0 0 rgba(255, 255, 255, 0.5) inset,
                0 4px 16px -4px rgba(0, 0, 0, 0.1),
                0 8px 32px -8px rgba(0, 0, 0, 0.08);
        }

        .nav-group {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        select, button {
            font-family: inherit;
            font-size: 13px;
            font-weight: 450;
            padding: 8px 14px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            background: var(--control-bg);
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            letter-spacing: 0.01em;
        }

        select:hover, button:hover {
            background: var(--control-hover);
            border-color: rgba(255, 255, 255, 0.12);
            transform: translateY(-1px);
        }

        select:active, button:active {
            transform: translateY(0);
        }

        select:focus, button:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.03);
        }

        select option {
            background: #1a1a24;
            color: var(--text-color);
            padding: 8px;
        }

        .theme-toggle {
            width: 38px;
            height: 38px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            border-radius: 12px;
        }

        .nav-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            text-decoration: none;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .nav-logo-orb {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            position: relative;
            background: radial-gradient(circle at 30% 30%,
                rgba(139, 92, 246, 0.6) 0%,
                rgba(6, 182, 212, 0.4) 50%,
                rgba(16, 185, 129, 0.3) 100%);
            box-shadow:
                0 0 15px rgba(139, 92, 246, 0.4),
                0 0 30px rgba(6, 182, 212, 0.2),
                inset 0 0 10px rgba(255, 255, 255, 0.1);
            transition: transform 0.1s ease-out;
        }

        .nav-logo-orb::before {
            content: '';
            position: absolute;
            inset: 3px;
            border-radius: 50%;
            background-image: radial-gradient(circle, rgba(255,255,255,0.8) 1px, transparent 1px);
            background-size: 5px 5px;
            -webkit-mask-image: radial-gradient(circle at center, black 20%, transparent 70%);
            mask-image: radial-gradient(circle at center, black 20%, transparent 70%);
        }

        .nav-logo:hover .nav-logo-orb {
            box-shadow:
                0 0 20px rgba(139, 92, 246, 0.6),
                0 0 40px rgba(6, 182, 212, 0.3),
                inset 0 0 10px rgba(255, 255, 255, 0.15);
        }

        .nav-title {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            font-weight: 300;
            letter-spacing: 0.3em;
            color: var(--text-color);
            margin: 0;
            opacity: 0.9;
            text-transform: uppercase;
            transition: transform 0.1s ease-out;
            transform-origin: center;
        }

        .music-select {
            width: 150px;
        }

        .music-select.playing {
            background: rgba(120, 200, 160, 0.12);
            border-color: rgba(120, 200, 160, 0.25);
            box-shadow: 0 0 20px -5px rgba(120, 200, 160, 0.2);
        }

        .pattern-select {
            width: 140px;
        }

        .bg-select {
            width: 140px;
        }

        /* Background Image Layer */
        .bg-layer {
            position: fixed;
            inset: -5%;
            width: 110%;
            height: 110%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0;
            transition: opacity 0.5s ease;
            z-index: -1;
            pointer-events: none;
            transform-origin: center center;
        }

        .bg-layer.active {
            opacity: 0.4;
            animation: bgBreathe 12s ease-in-out infinite;
        }

        [data-theme="light"] .bg-layer.active {
            opacity: 0.25;
        }

        @keyframes bgBreathe {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.08);
            }
        }

        /* CRT TV Effect Overlay */
        .tv-effect {
            position: fixed;
            inset: 0;
            z-index: 9999;
            pointer-events: none;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
        }

        .tv-effect.active {
            opacity: 1;
            visibility: visible;
        }

        .tv-screen {
            width: 100vw;
            height: 100vh;
            background: rgba(200, 220, 255, 0.85);
            transform: scale(0, 0);
            box-shadow: 0 0 60px 30px rgba(200, 220, 255, 0.5),
                        0 0 120px 60px rgba(200, 220, 255, 0.25);
            filter: blur(2px);
        }

        /* Turn OFF animation (dark to light) */
        @keyframes tvTurnOff {
            0% {
                transform: scale(1, 1);
                filter: blur(0px) brightness(0.9);
                opacity: 0.9;
            }
            40% {
                transform: scale(1, 0.012);
                filter: blur(2px) brightness(1.2);
                opacity: 1;
            }
            70% {
                transform: scale(0.5, 0.008);
                filter: blur(3px) brightness(1.3);
                opacity: 0.8;
            }
            100% {
                transform: scale(0, 0);
                filter: blur(4px) brightness(1);
                opacity: 0;
            }
        }

        /* Turn ON animation (light to dark) */
        @keyframes tvTurnOn {
            0% {
                transform: scale(0, 0);
                filter: blur(4px) brightness(1);
                opacity: 0;
            }
            30% {
                transform: scale(0.5, 0.008);
                filter: blur(3px) brightness(1.3);
                opacity: 0.8;
            }
            60% {
                transform: scale(1, 0.012);
                filter: blur(2px) brightness(1.2);
                opacity: 1;
            }
            100% {
                transform: scale(1, 1);
                filter: blur(0px) brightness(0.9);
                opacity: 0.9;
            }
        }

        .tv-screen.turn-off {
            animation: tvTurnOff 0.6s cubic-bezier(0.4, 0, 0.6, 1) forwards;
        }

        .tv-screen.turn-on {
            animation: tvTurnOn 0.6s cubic-bezier(0.2, 0, 0.6, 1) forwards;
        }

        /* Custom Pattern Panel */
        .custom-panel {
            position: fixed;
            top: 75px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--nav-bg);
            backdrop-filter: blur(40px) saturate(180%);
            -webkit-backdrop-filter: blur(40px) saturate(180%);
            border: 1px solid var(--nav-border);
            border-radius: 16px;
            padding: 18px 24px;
            z-index: 1000;
            box-shadow:
                0 1px 0 0 var(--nav-glow) inset,
                0 12px 40px -12px rgba(0, 0, 0, 0.4);
        }

        .custom-panel.hidden {
            display: none;
        }

        .custom-inputs {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .custom-inputs label {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-color);
            font-size: 13px;
            font-weight: 450;
            letter-spacing: 0.01em;
        }

        .custom-inputs input {
            width: 52px;
            padding: 8px 10px;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            background: var(--control-bg);
            color: var(--text-color);
            font-size: 14px;
            font-weight: 500;
            text-align: center;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .custom-inputs input:hover {
            background: var(--control-hover);
            border-color: rgba(255, 255, 255, 0.12);
        }

        .custom-inputs input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.03);
        }

        .custom-inputs .unit {
            color: var(--text-muted);
            font-size: 12px;
            font-weight: 400;
        }

        /* Orb Container */
        .orb-container {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 400px;
            height: 400px;
        }

        /* Particle Orb Wrapper - JS controls scale, CSS handles rotation only */
        .wrap {
            position: relative;
            width: 0;
            height: 0;
            transform-style: preserve-3d;
            perspective: 1000px;
            animation: rotate 20s infinite linear;
            transition: transform 0.1s linear;
        }

        @keyframes rotate {
            100% {
                transform: rotateY(360deg) rotateX(360deg);
            }
        }

        /* Individual particle */
        .c {
            position: absolute;
            width: 3px;
            height: 3px;
            border-radius: 50%;
            opacity: 0;
            box-shadow: 0 0 6px 1px currentColor;
        }

        /* Breathing text - classic cinema subtitle style (Helvetica, soft yellow, thin outline) */
        .breath-text {
            position: fixed;
            bottom: 5%;
            left: 50%;
            transform: translateX(-50%);
            font-family: Helvetica, 'Helvetica Neue', Arial, sans-serif;
            font-size: 42px;
            font-weight: 400;
            letter-spacing: 0.5px;
            color: #F8E473;
            text-align: center;
            text-shadow:
                1px 1px 0 #000,
                -1px 1px 0 #000,
                1px -1px 0 #000,
                -1px -1px 0 #000,
                0 1px 0 #000,
                0 -1px 0 #000,
                1px 0 0 #000,
                -1px 0 0 #000;
            z-index: 10;
            pointer-events: none;
            opacity: 1;
            transition: opacity 0.3s ease;
            max-width: 90%;
            line-height: 1.3;
            text-transform: uppercase;
        }

        .countdown {
            display: block;
            font-size: 28px;
            font-weight: 400;
            margin-top: 6px;
            letter-spacing: 1px;
            opacity: 0.9;
        }

        [data-theme="light"] .breath-text {
            color: #D4AF37;
            text-shadow:
                1px 1px 0 #000,
                -1px 1px 0 #000,
                1px -1px 0 #000,
                -1px -1px 0 #000,
                0 1px 0 #000,
                0 -1px 0 #000,
                1px 0 0 #000,
                -1px 0 0 #000;
        }

        /* Glow effect behind orb - JS controlled */
        .orb-glow {
            position: absolute;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: radial-gradient(circle,
                rgba(139, 92, 246, 0.3) 0%,
                rgba(6, 182, 212, 0.15) 40%,
                transparent 70%);
            filter: blur(40px);
            pointer-events: none;
            transition: transform 0.1s linear, opacity 0.1s linear;
        }

        [data-theme="light"] .orb-glow {
            opacity: 0.5;
        }

        /* Hamburger Button */
        .hamburger-btn {
            font-size: 20px;
            width: 38px;
            height: 38px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
        }

        /* Hamburger Menu Dropdown */
        .hamburger-menu {
            position: fixed;
            top: 65px;
            left: 28px;
            background: var(--nav-bg);
            backdrop-filter: blur(40px) saturate(180%);
            -webkit-backdrop-filter: blur(40px) saturate(180%);
            border: 1px solid var(--nav-border);
            border-radius: 12px;
            padding: 8px;
            z-index: 200;
            box-shadow:
                0 1px 0 0 var(--nav-glow) inset,
                0 12px 40px -12px rgba(0, 0, 0, 0.4);
            min-width: 180px;
        }

        .hamburger-menu.hidden {
            display: none;
        }

        .menu-item {
            display: block;
            width: 100%;
            padding: 12px 16px;
            background: none;
            border: none;
            border-radius: 8px;
            color: var(--text-color);
            font-size: 14px;
            font-weight: 450;
            text-align: left;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .menu-item:hover {
            background: var(--control-hover);
            transform: none;
        }

        /* Modal Overlay */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        .modal-overlay.hidden {
            display: none;
        }

        .modal-content {
            background: var(--nav-bg);
            backdrop-filter: blur(40px) saturate(180%);
            -webkit-backdrop-filter: blur(40px) saturate(180%);
            border: 1px solid var(--nav-border);
            border-radius: 20px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 28px 32px;
            position: relative;
            box-shadow:
                0 1px 0 0 var(--nav-glow) inset,
                0 25px 80px -20px rgba(0, 0, 0, 0.5);
        }

        .modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--control-bg);
            border: 1px solid var(--border-color);
            color: var(--text-muted);
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            line-height: 1;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: var(--control-hover);
            color: var(--text-color);
        }

        .modal-content h2 {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 20px;
            letter-spacing: -0.01em;
        }

        .modal-body {
            font-size: 13px;
            line-height: 1.7;
            color: var(--text-muted);
        }

        .modal-body p {
            margin-bottom: 14px;
        }

        .modal-body strong {
            color: var(--text-color);
            font-weight: 600;
        }

        .modal-footer-text {
            margin-top: 20px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
            font-style: italic;
            opacity: 0.8;
        }

        .section-heading {
            font-size: 1.1em;
            font-weight: 600;
            color: var(--text-color);
            margin-top: 20px;
            margin-bottom: 8px;
        }

        .section-heading:first-child {
            margin-top: 0;
        }

        .references {
            font-size: 0.9em;
            margin-top: 16px;
        }

        .references p {
            margin-bottom: 10px;
        }

        .references a {
            color: var(--text-muted);
            text-decoration: none;
            word-break: break-all;
        }

        .references a:hover {
            color: var(--text-color);
            text-decoration: underline;
        }

        /* Body scroll lock when modal open */
        body.modal-open {
            overflow: hidden;
        }

        /* Card Overlay */
        .card-overlay {
            position: fixed;
            inset: 0;
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease, visibility 0.5s ease;
            cursor: pointer;
        }

        .card-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .blog-card {
            width: min(90vw, 650px);
            min-height: 400px;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 50px 40px 40px;
            background-color: #050508;
            background-image:
                radial-gradient(ellipse at 50% 0%, rgba(25, 25, 40, 0.5) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 100%, rgba(15, 20, 30, 0.3) 0%, transparent 40%),
                linear-gradient(180deg, #080810 0%, #0a0a12 50%, #060608 100%);
            box-shadow: 0 50px 100px -20px rgba(0,0,0,0.5);
            border-radius: 20px;
            cursor: default;
            animation: cardBreathe 4s ease-in-out infinite;
        }

        .card-close {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 36px;
            height: 36px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
            font-size: 24px;
            line-height: 1;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 20;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card-close:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            transform: scale(1.1);
        }

        @keyframes cardBreathe {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.03);
            }
        }

        .card-code-texture {
            position: absolute;
            inset: 0;
            opacity: 0.03;
            background-image: linear-gradient(rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 100% 20px;
            pointer-events: none;
        }

        .card-orb-glow {
            position: absolute;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle,
                rgba(139, 92, 246, 0.4) 0%,
                rgba(6, 182, 212, 0.2) 40%,
                transparent 70%);
            filter: blur(40px);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -60%);
            animation: glowPulse 4s ease-in-out infinite;
        }

        @keyframes glowPulse {
            0%, 100% {
                opacity: 0.8;
                transform: translate(-50%, -60%) scale(1);
            }
            50% {
                opacity: 1;
                transform: translate(-50%, -60%) scale(1.1);
            }
        }

        .card-particle-orb {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            position: relative;
            transform: translateY(-20px);
            background-image: radial-gradient(circle, rgba(255,255,255,0.9) 1.5px, transparent 2px);
            background-size: 15px 15px;
            background-position: center;
            -webkit-mask-image: radial-gradient(circle at center, black 30%, transparent 70%);
            mask-image: radial-gradient(circle at center, black 30%, transparent 70%);
            animation: orbBreathe 4s ease-in-out infinite;
        }

        @keyframes orbBreathe {
            0%, 100% {
                transform: translateY(-20px) scale(1);
            }
            50% {
                transform: translateY(-20px) scale(1.15);
            }
        }

        .card-particle-orb::after {
            content: '';
            position: absolute;
            inset: 0;
            background-image: radial-gradient(circle, rgba(139, 92, 246, 0.8) 2px, transparent 2.5px);
            background-size: 12px 12px;
            transform: rotate(15deg) scale(0.8);
            -webkit-mask-image: radial-gradient(circle at center, black 40%, transparent 60%);
        }

        .card-text-container {
            margin-top: 20px;
            text-align: center;
            z-index: 10;
        }

        .card-title {
            font-family: Helvetica, 'Helvetica Neue', Arial, sans-serif;
            font-size: clamp(28px, 7vw, 42px);
            font-weight: 300;
            letter-spacing: 0.1em;
            color: #F8E473;
            line-height: 1;
            margin-bottom: 20px;
        }

        .card-description {
            font-family: Georgia, 'Times New Roman', serif;
            font-size: clamp(14px, 3.5vw, 17px);
            font-weight: 400;
            line-height: 1.8;
            color: rgba(255, 255, 255, 0.75);
            text-align: center;
            max-width: 540px;
            margin: 0;
            font-style: italic;
        }

        .card-glass-frame {
            position: absolute;
            inset: 20px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            background: linear-gradient(180deg, rgba(255,255,255,0.03) 0%, transparent 100%);
            box-shadow: inset 0 0 0 1px rgba(255,255,255,0.02);
            pointer-events: none;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .navbar {
                padding: 10px 16px;
                flex-wrap: wrap;
                gap: 10px;
            }

            .nav-group {
                gap: 8px;
            }

            select, button {
                font-size: 12px;
                padding: 6px 10px;
            }

            .music-select {
                width: 120px;
            }

            .pattern-select {
                width: 120px;
            }

            .bg-select {
                width: 120px;
            }

            .nav-title {
                display: none;
            }

            .nav-logo {
                width: 30px;
                height: 30px;
                margin-right: 8px;
            }

            .nav-logo-orb {
                width: 24px;
                height: 24px;
            }

            .custom-panel {
                top: auto;
                bottom: auto;
                margin-top: 10px;
                position: relative;
                width: 100%;
                left: 0;
                transform: none;
                padding: 12px 16px;
            }

            .custom-inputs {
                gap: 12px;
                flex-wrap: wrap;
                justify-content: center;
            }

            .custom-inputs label {
                font-size: 12px;
            }

            .custom-inputs input {
                width: 45px;
                padding: 5px 6px;
                font-size: 13px;
            }

            .orb-container {
                width: 300px;
                height: 300px;
            }

            .breath-text {
                font-size: 22px;
                bottom: 6%;
            }

            .countdown {
                font-size: 18px;
            }

            .orb-glow {
                width: 220px;
                height: 220px;
            }

            .hamburger-menu {
                left: 16px;
                top: 60px;
            }

            .modal-content {
                padding: 24px 20px;
                border-radius: 16px;
                max-height: 85vh;
            }

            .modal-content h2 {
                font-size: 16px;
            }

            .modal-body {
                font-size: 12px;
            }
        }
    </style>
</head>
<body data-theme="dark">
    <div id="bgLayer" class="bg-layer"></div>
    <div id="tvEffect" class="tv-effect">
        <div id="tvScreen" class="tv-screen"></div>
    </div>
    <nav class="navbar">
        <div class="nav-group">
            <a href="/" class="nav-logo" aria-label="Home">
                <div class="nav-logo-orb" id="navLogoOrb"></div>
            </a>
            <button id="hamburgerBtn" class="hamburger-btn" aria-label="Menu">☰</button>
            <select id="pattern" class="pattern-select" aria-label="Select breathing pattern">
                <option value="gentle">Gentle 4-2-6</option>
                <option value="moderate" selected>Moderate 4-4-6</option>
                <option value="advanced">Advanced 4-7-8</option>
                <option value="custom">Custom</option>
            </select>
        </div>

        <h1 class="nav-title" id="navTitle">BREATHE</h1>

        <div id="customPanel" class="custom-panel hidden">
            <div class="custom-inputs">
                <label>
                    <span>Inhale</span>
                    <input type="number" id="customInhale" min="1" max="30" value="4">
                    <span class="unit">s</span>
                </label>
                <label>
                    <span>Hold</span>
                    <input type="number" id="customHold" min="0" max="30" value="4">
                    <span class="unit">s</span>
                </label>
                <label>
                    <span>Exhale</span>
                    <input type="number" id="customExhale" min="1" max="30" value="6">
                    <span class="unit">s</span>
                </label>
            </div>
        </div>

        <div class="nav-group">
            <select id="musicSelect" class="music-select" aria-label="Select music">
                <option value="off">Music Off</option>
                <option value="0">♫ Peaceful</option>
                <option value="1">♫ Soothing</option>
                <option value="2">♫ Tranquil</option>
                <option value="3">♫ Ambient</option>
            </select>
            <select id="bgSelect" class="bg-select" aria-label="Select background">
                <option value="1">Ocean</option>
                <option value="2">Galaxy</option>
                <option value="4">Sky</option>
                <option value="none">Pure Black</option>
            </select>
            <button id="themeToggle" class="theme-toggle" aria-label="Toggle theme">☀</button>
        </div>
    </nav>

    <div class="orb-container">
        <div class="orb-glow" id="orbGlow"></div>
        <div class="wrap" id="wrap"></div>
    </div>

    <div class="breath-text" id="breathText">
        <span id="phaseText">Breathe In</span>
        <span class="countdown" id="countdown">4</span>
    </div>

    <audio id="radioAudio" preload="none"></audio>

    <!-- Hamburger Menu Dropdown -->
    <div id="hamburgerMenu" class="hamburger-menu hidden">
        <button id="menuDisclaimer" class="menu-item">Disclaimer & Safety</button>
        <button id="menuScience" class="menu-item">The Science</button>
        <button id="menuCard" class="menu-item">Why Breathe?</button>
    </div>

    <!-- Disclaimer Modal -->
    <div id="disclaimerModal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close" aria-label="Close">&times;</button>
            <h2>Disclaimer & Safety</h2>
            <div class="modal-body">
                <p class="section-heading">DISCLAIMER & WAIVER</p>
                <p>This breathing exercise application ("Breathe") is provided for relaxation and general wellness purposes only. It does not constitute medical advice, diagnosis, or treatment, and is not a substitute for professional healthcare.</p>

                <p class="section-heading">ASSUMPTION OF RISK</p>
                <p>By using this application, you acknowledge that breathing exercises carry inherent risks including but not limited to dizziness, hyperventilation, lightheadedness, fainting, tingling, anxiety, and in rare cases, more serious adverse effects. You voluntarily assume all risks associated with use.</p>

                <p><strong>STOP IMMEDIATELY</strong> if you experience dizziness, chest pain, shortness of breath, tingling, nausea, or any discomfort.</p>

                <p><strong>DO NOT USE</strong> while driving, operating machinery, in water, or in any situation where impaired consciousness could be dangerous.</p>

                <p><strong>CONSULT A PHYSICIAN</strong> before use if you are pregnant, have cardiovascular disease, respiratory conditions, low or high blood pressure, a history of fainting, panic disorder, epilepsy, or any other medical condition.</p>

                <p class="section-heading">LIMITATION OF LIABILITY</p>
                <p>To the fullest extent permitted by law, the creators, developers, and distributors of this application shall not be held liable for any direct, indirect, incidental, consequential, or punitive damages arising from your use of this application. This includes, without limitation, any injury, illness, or adverse health effect.</p>

                <p class="section-heading">NO WARRANTY</p>
                <p>This application is provided "as is" without warranties of any kind, express or implied, including fitness for a particular purpose.</p>

                <p class="section-heading">INDEMNIFICATION</p>
                <p>You agree to indemnify and hold harmless the creators and distributors of this application from any claims, damages, or expenses arising from your use.</p>

                <p class="modal-footer-text">By continuing to use this application, you confirm that you have read, understood, and agree to this disclaimer.</p>

            </div>
        </div>
    </div>

    <!-- Science Modal -->
    <div id="scienceModal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close" aria-label="Close">&times;</button>
            <h2>The Science Behind Breathe</h2>
            <div class="modal-body">
                <p class="section-heading">HOW SLOW BREATHING WORKS</p>
                <p>Slow-paced breathing in the range of 4–7 breaths per minute activates the parasympathetic nervous system, often called the "rest and digest" response. This occurs through several interconnected mechanisms:</p>

                <p class="section-heading">HEART RATE VARIABILITY & VAGAL TONE</p>
                <p>Breathing at approximately 6 breaths per minute (0.1 Hz) resonates with the baroreflex system, maximising heart rate variability — a key marker of autonomic flexibility and stress resilience. This "resonance frequency" breathing has been widely adopted in HRV biofeedback protocols.</p>

                <p class="section-heading">EXTENDED EXHALATION & PARASYMPATHETIC ACTIVATION</p>
                <p>Exhalation activates the vagus nerve, which slows heart rate and promotes relaxation. Breathing patterns where the exhale is equal to or longer than the inhale consistently enhance parasympathetic activity.</p>

                <p class="section-heading">THE BREATH HOLD & THE BOHR EFFECT</p>
                <p>A brief breath hold after inhalation allows additional time for gas exchange in the alveoli and permits a slight rise in blood CO₂ (carbon dioxide). This modest CO₂ increase shifts haemoglobin's oxygen-binding affinity via the Bohr effect, facilitating oxygen release to peripheral tissues. Contrary to common belief, oxygenation occurs throughout the respiratory cycle — not exclusively during the hold — but the hold can optimise tissue oxygen delivery.</p>

                <p class="section-heading">THE 4-7-8 TECHNIQUE</p>
                <p>Developed by Dr. Andrew Weil and rooted in pranayama yoga traditions, the 4-7-8 pattern (4s inhale, 7s hold, 8s exhale) has been studied in clinical settings. Research indicates it can reduce anxiety, lower blood pressure, and increase parasympathetic markers, particularly high-frequency HRV.</p>

                <p class="section-heading">THE PATTERNS IN THIS APP</p>
                <p>• <strong>Gentle (4–2–6):</strong> 12s cycle, 5.0 breaths/min — Entry-level with minimal hold<br>
                • <strong>Moderate (4–4–6):</strong> 14s cycle, 4.3 breaths/min — Balanced HRV optimisation<br>
                • <strong>Advanced (4–7–8):</strong> 19s cycle, 3.2 breaths/min — Dr. Weil's method for deep relaxation</p>
                <p>All three patterns fall within or near the 4–7 breaths/minute range associated with enhanced HRV and parasympathetic activation in the literature.</p>

                <p class="section-heading">IMPORTANT CAVEATS</p>
                <p>• Most studies on breathing techniques involve small sample sizes and short intervention periods. While results are promising, evidence quality varies.<br>
                • Individual responses differ; what induces calm in one person may cause discomfort in another.<br>
                • Extended breath holds are not suitable for everyone — particularly those with cardiovascular, respiratory, or anxiety conditions.</p>

                <p class="section-heading">SCIENTIFIC REFERENCES</p>
                <div class="references">
                    <p>1. Lehrer, P. M., & Gevirtz, R. (2014). Heart rate variability biofeedback: How and why does it work? <em>Frontiers in Psychology</em>, 5, 756. <a href="https://doi.org/10.3389/fpsyg.2014.00756" target="_blank" rel="noopener noreferrer">doi.org/10.3389/fpsyg.2014.00756</a></p>
                    <p>2. Shaffer, F., & Ginsberg, J. P. (2017). An overview of heart rate variability metrics and norms. <em>Frontiers in Public Health</em>, 5, 258. <a href="https://doi.org/10.3389/fpubh.2017.00258" target="_blank" rel="noopener noreferrer">doi.org/10.3389/fpubh.2017.00258</a></p>
                    <p>3. Gerritsen, R. J. S., & Band, G. P. H. (2018). Breath of life: The respiratory vagal stimulation model of contemplative activity. <em>Frontiers in Human Neuroscience</em>, 12, 397. <a href="https://doi.org/10.3389/fnhum.2018.00397" target="_blank" rel="noopener noreferrer">doi.org/10.3389/fnhum.2018.00397</a></p>
                    <p>4. Zaccaro, A., Piarulli, A., Laurino, M., et al. (2018). How breath-control can change your life: A systematic review on psycho-physiological correlates of slow breathing. <em>Frontiers in Human Neuroscience</em>, 12, 353. <a href="https://doi.org/10.3389/fnhum.2018.00353" target="_blank" rel="noopener noreferrer">doi.org/10.3389/fnhum.2018.00353</a></p>
                    <p>5. Bohr, C., Hasselbalch, K., & Krogh, A. (1904). Concerning a biologically important relationship — the influence of the carbon dioxide content of blood on its oxygen binding. <em>Skandinavisches Archiv für Physiologie</em>, 16, 402–412.</p>
                    <p>6. West, J. B., & Luks, A. M. (2021). <em>West's Respiratory Physiology: The Essentials</em> (11th ed.). Wolters Kluwer.</p>
                    <p>7. Vierra, J., Boonla, O., & Prasertsri, P. (2022). Effects of sleep deprivation and 4-7-8 breathing control on heart rate variability, blood pressure, blood glucose, and endothelial function in healthy young adults. <em>Physiological Reports</em>, 10(13), e15389. <a href="https://doi.org/10.14814/phy2.15389" target="_blank" rel="noopener noreferrer">doi.org/10.14814/phy2.15389</a></p>
                    <p>8. Toschi-Dias, E., Tobaldini, E., Solbiati, M., et al. (2017). Sudarshan Kriya Yoga improves cardiac autonomic control in patients with anxiety-depression disorders. <em>Journal of Affective Disorders</em>, 214, 74–80. <a href="https://doi.org/10.1016/j.jad.2017.03.017" target="_blank" rel="noopener noreferrer">doi.org/10.1016/j.jad.2017.03.017</a></p>
                    <p>9. Kurt Aktaş, G., et al. (2023). The effect of deep breathing exercise and 4-7-8 breathing techniques applied to patients after bariatric surgery on anxiety and quality of life. <em>Obesity Surgery</em>, 33(3), 920–929. <a href="https://pubmed.ncbi.nlm.nih.gov/36480101/" target="_blank" rel="noopener noreferrer">PubMed</a></p>
                    <p>10. Hopper, S. I., Murray, S. L., Ferrara, L. R., & Singleton, J. K. (2019). Effectiveness of diaphragmatic breathing for reducing physiological and psychological stress in adults: A quantitative systematic review. <em>JBI Database of Systematic Reviews and Implementation Reports</em>, 17(9), 1855–1876. <a href="https://doi.org/10.11124/JBISRIR-2017-003848" target="_blank" rel="noopener noreferrer">doi.org/10.11124/JBISRIR-2017-003848</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Card Overlay -->
    <div id="cardOverlay" class="card-overlay hidden">
        <div class="blog-card" id="blogCard">
            <button class="card-close" id="cardCloseBtn" aria-label="Close">&times;</button>
            <div class="card-code-texture"></div>
            <div class="card-orb-glow"></div>
            <div class="card-particle-orb"></div>
            <div class="card-text-container">
                <div class="card-title">Why Breathe?</div>
                <p class="card-description">Deep, intentional breathing is one of the simplest yet most powerful tools for wellbeing. When you slow your breath, you activate your parasympathetic nervous system—the body's natural "rest and digest" mode—lowering cortisol, reducing blood pressure, and calming the mind. Just a few minutes of focused breathing can sharpen mental clarity, ease anxiety, improve sleep quality, and restore emotional balance. Ancient practices and modern science agree: conscious breathing transforms stress into serenity, one breath at a time.</p>
            </div>
            <div class="card-glass-frame"></div>
        </div>
    </div>

    <script>
        // ============================================
        // PARTICLE ORB CONFIGURATION
        // ============================================
        const TOTAL_PARTICLES = 250;
        const ORB_SIZE = 100;
        const PARTICLE_TIME = 14;
        let baseHue = 270;

        // Scale bounds
        const SCALE_MIN = 0.5;
        const SCALE_MAX = 1.8;

        // ============================================
        // BREATHING PATTERNS
        // ============================================
        const patterns = {
            gentle: [
                { key: 'in', ms: 4000 },
                { key: 'hold', ms: 2000 },
                { key: 'out', ms: 6000 }
            ],
            moderate: [
                { key: 'in', ms: 4000 },
                { key: 'hold', ms: 4000 },
                { key: 'out', ms: 6000 }
            ],
            advanced: [
                { key: 'in', ms: 4000 },
                { key: 'hold', ms: 7000 },
                { key: 'out', ms: 8000 }
            ]
        };

        // ============================================
        // BREATHING LABELS (English only)
        // ============================================
        const breathingLabels = {
            in: 'Breathe In',
            hold: 'Hold',
            out: 'Breathe Out'
        };

        // ============================================
        // LOCAL MUSIC TRACKS
        // ============================================
        const tracks = [
            'music/relax-meditate-gentle-peaceful-291162.mp3',
            'music/soothing-meditation-without-voice-315921.mp3',
            'music/zen-garden-310599.mp3',
            'music/zen-spiritual-yoga-massage-meditation-spa-relax-ambient-music-18403.mp3'
        ];

        // ============================================
        // DOM ELEMENTS
        // ============================================
        const wrap = document.getElementById('wrap');
        const orbGlow = document.getElementById('orbGlow');
        const navLogoOrb = document.getElementById('navLogoOrb');
        const navTitle = document.getElementById('navTitle');
        const breathText = document.getElementById('breathText');
        const phaseText = document.getElementById('phaseText');
        const countdownEl = document.getElementById('countdown');
        const patternSelect = document.getElementById('pattern');
        const themeToggle = document.getElementById('themeToggle');
        const musicSelect = document.getElementById('musicSelect');
        const radioAudio = document.getElementById('radioAudio');
        const customPanel = document.getElementById('customPanel');
        const customInhale = document.getElementById('customInhale');
        const customHold = document.getElementById('customHold');
        const customExhale = document.getElementById('customExhale');
        const bgSelect = document.getElementById('bgSelect');
        const bgLayer = document.getElementById('bgLayer');
        const tvEffect = document.getElementById('tvEffect');
        const tvScreen = document.getElementById('tvScreen');
        const hamburgerBtn = document.getElementById('hamburgerBtn');
        const hamburgerMenu = document.getElementById('hamburgerMenu');
        const disclaimerModal = document.getElementById('disclaimerModal');
        const scienceModal = document.getElementById('scienceModal');
        const cardOverlay = document.getElementById('cardOverlay');
        const blogCard = document.getElementById('blogCard');

        // ============================================
        // STATE
        // ============================================
        let currentPattern = localStorage.getItem('breathPattern') || 'moderate';
        let pendingPattern = null; // Pattern to apply at next cycle
        let currentBg = localStorage.getItem('breathBg') || '1';

        // Load custom pattern values from localStorage
        const savedCustom = JSON.parse(localStorage.getItem('customBreathPattern') || '{"inhale":4,"hold":4,"exhale":6}');
        customInhale.value = savedCustom.inhale;
        customHold.value = savedCustom.hold;
        customExhale.value = savedCustom.exhale;
        let isPlaying = false;

        // Animation state
        let currentPhaseIndex = 0;
        let phaseStartTime = 0;
        let animationFrameId = null;
        let currentScale = SCALE_MIN;

        // Initialize pattern dropdown
        patternSelect.value = currentPattern;
        // Show custom panel if custom pattern was saved
        if (currentPattern === 'custom') {
            customPanel.classList.remove('hidden');
        }

        // ============================================
        // PARTICLE ORB CREATION
        // ============================================
        function createParticleOrb() {
            const styleSheet = document.createElement('style');
            let css = '';

            for (let i = 1; i <= TOTAL_PARTICLES; i++) {
                const particle = document.createElement('div');
                particle.className = 'c';
                particle.id = `p${i}`;
                wrap.appendChild(particle);

                const z = Math.random() * 360;
                const y = Math.random() * 360;

                css += `
                    .c:nth-child(${i}) {
                        animation: orbit${i} ${PARTICLE_TIME}s infinite;
                        animation-delay: ${i * 0.01}s;
                    }
                    @keyframes orbit${i} {
                        0% {
                            opacity: 0;
                            transform: rotateZ(${-z}deg) rotateY(${y}deg) translateX(0) rotateZ(${z}deg);
                        }
                        15% {
                            opacity: 1;
                            transform: rotateZ(${-z}deg) rotateY(${y}deg) translateX(${ORB_SIZE}px) rotateZ(${z}deg);
                        }
                        100% {
                            opacity: 1;
                            transform: rotateZ(${-z}deg) rotateY(${y}deg) translateX(${ORB_SIZE}px) rotateZ(${z}deg);
                        }
                    }
                `;
            }

            styleSheet.textContent = css;
            document.head.appendChild(styleSheet);
        }

        // ============================================
        // COLOR CYCLING
        // ============================================
        function updateParticleColors() {
            const particles = document.querySelectorAll('.c');
            particles.forEach((particle, i) => {
                const hue = (baseHue + (40 / TOTAL_PARTICLES) * i) % 360;
                particle.style.color = `hsl(${hue}, 100%, 60%)`;
                particle.style.backgroundColor = `hsl(${hue}, 100%, 60%)`;
            });

            const hue1 = baseHue;
            const hue2 = (baseHue + 60) % 360;
            orbGlow.style.background = `radial-gradient(circle,
                hsla(${hue1}, 80%, 50%, 0.3) 0%,
                hsla(${hue2}, 80%, 50%, 0.15) 40%,
                transparent 70%)`;
        }

        function colorCycle() {
            baseHue = (baseHue + 0.3) % 360;
            updateParticleColors();
            requestAnimationFrame(colorCycle);
        }

        // ============================================
        // ORB SCALE ANIMATION (JS-driven)
        // ============================================
        function setOrbScale(scale) {
            currentScale = scale;
            wrap.style.scale = scale;
            // Glow follows orb scale with slight amplification
            const glowScale = 0.5 + (scale - SCALE_MIN) / (SCALE_MAX - SCALE_MIN) * 1.5;
            const glowOpacity = 0.4 + (scale - SCALE_MIN) / (SCALE_MAX - SCALE_MIN) * 0.5;
            orbGlow.style.transform = `scale(${glowScale})`;
            orbGlow.style.opacity = glowOpacity;

            // Sync navbar logo orb and title with breathing
            // Map scale (0.5-1.8) to subtle range (0.85-1.15) for nav elements
            const navProgress = (scale - SCALE_MIN) / (SCALE_MAX - SCALE_MIN);
            const navLogoScale = 0.85 + navProgress * 0.3;
            const navTitleScale = 0.95 + navProgress * 0.1;

            navLogoOrb.style.transform = `scale(${navLogoScale})`;
            navTitle.style.transform = `translateX(-50%) scale(${navTitleScale})`;
        }

        // Easing function for smooth transitions
        function easeInOutQuad(t) {
            return t < 0.5 ? 2 * t * t : 1 - Math.pow(-2 * t + 2, 2) / 2;
        }

        // ============================================
        // TEXT & COUNTDOWN DISPLAY
        // ============================================
        function getPhaseLabel(key) {
            return breathingLabels[key];
        }

        function updateDisplay(phaseKey, secondsRemaining) {
            phaseText.textContent = getPhaseLabel(phaseKey);
            countdownEl.textContent = secondsRemaining;
        }

        // ============================================
        // BREATHING SCHEDULER
        // ============================================
        function getPattern() {
            if (currentPattern === 'custom') {
                return [
                    { key: 'in', ms: parseInt(customInhale.value) * 1000 || 4000 },
                    { key: 'hold', ms: parseInt(customHold.value) * 1000 || 0 },
                    { key: 'out', ms: parseInt(customExhale.value) * 1000 || 6000 }
                ].filter(phase => phase.ms > 0); // Remove hold if 0
            }
            return patterns[currentPattern];
        }

        function startPhase(phaseIndex) {
            const pattern = getPattern();
            currentPhaseIndex = phaseIndex % pattern.length;
            phaseStartTime = performance.now();

            // If starting a new cycle (phase 0), check for pending pattern change
            if (currentPhaseIndex === 0 && pendingPattern) {
                currentPattern = pendingPattern;
                pendingPattern = null;
                localStorage.setItem('breathPattern', currentPattern);
            }
        }

        function breathingLoop(timestamp) {
            const pattern = getPattern();
            const phase = pattern[currentPhaseIndex];
            const elapsed = timestamp - phaseStartTime;
            const progress = Math.min(elapsed / phase.ms, 1);
            const easedProgress = easeInOutQuad(progress);

            // Calculate seconds remaining (update at least every 250ms means we show whole seconds)
            const msRemaining = Math.max(0, phase.ms - elapsed);
            const secondsRemaining = Math.ceil(msRemaining / 1000);

            // Update orb scale based on phase
            if (phase.key === 'in') {
                // Inhale: scale from MIN to MAX
                const scale = SCALE_MIN + (SCALE_MAX - SCALE_MIN) * easedProgress;
                setOrbScale(scale);
            } else if (phase.key === 'hold') {
                // Hold: stay at MAX with very subtle 1.5% pulse at 0.4Hz
                const pulsePhase = (elapsed / 1000) * Math.PI * 0.8; // 0.4Hz = slower, calmer
                const pulse = Math.sin(pulsePhase) * 0.015; // ±1.5% - barely perceptible
                setOrbScale(SCALE_MAX * (1 + pulse));
            } else if (phase.key === 'out') {
                // Exhale: scale from MAX to MIN
                const scale = SCALE_MAX - (SCALE_MAX - SCALE_MIN) * easedProgress;
                setOrbScale(scale);
            }

            // Update display
            updateDisplay(phase.key, secondsRemaining);

            // Check if phase is complete
            if (progress >= 1) {
                startPhase(currentPhaseIndex + 1);
            }

            animationFrameId = requestAnimationFrame(breathingLoop);
        }

        function startBreathing() {
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
            }
            startPhase(0);
            animationFrameId = requestAnimationFrame(breathingLoop);
        }

        // ============================================
        // EVENT HANDLERS
        // ============================================
        patternSelect.addEventListener('change', (e) => {
            // Queue pattern change for next cycle start
            pendingPattern = e.target.value;
            // Show/hide custom panel
            if (e.target.value === 'custom') {
                customPanel.classList.remove('hidden');
            } else {
                customPanel.classList.add('hidden');
            }
        });

        // Custom pattern inputs - save to localStorage on change
        function saveCustomPattern() {
            const custom = {
                inhale: parseInt(customInhale.value) || 4,
                hold: parseInt(customHold.value) || 0,
                exhale: parseInt(customExhale.value) || 6
            };
            localStorage.setItem('customBreathPattern', JSON.stringify(custom));
        }

        customInhale.addEventListener('change', saveCustomPattern);
        customHold.addEventListener('change', saveCustomPattern);
        customExhale.addEventListener('change', saveCustomPattern);

        themeToggle.addEventListener('click', () => {
            const body = document.body;
            const isDark = body.getAttribute('data-theme') === 'dark';

            // Reset animation classes
            tvScreen.classList.remove('turn-on', 'turn-off');

            // Show the TV effect overlay
            tvEffect.classList.add('active');

            // Trigger the appropriate animation
            // Force reflow to restart animation
            void tvScreen.offsetWidth;
            tvScreen.classList.add(isDark ? 'turn-off' : 'turn-on');

            // Change theme at the midpoint of animation (when line is thinnest)
            setTimeout(() => {
                body.setAttribute('data-theme', isDark ? 'light' : 'dark');
                themeToggle.textContent = isDark ? '☾' : '☀';
            }, 250);

            // Hide overlay after animation completes
            setTimeout(() => {
                tvEffect.classList.remove('active');
                tvScreen.classList.remove('turn-on', 'turn-off');
            }, 650);
        });

        // Background selection
        const bgImages = {
            '1': 'backgr/damien-dufour-TH2cSJMA4ik-unsplash.jpg',
            '2': 'backgr/jackson-hendry-eodA_8CTOFo-unsplash.jpg',
            '4': 'backgr/sam-schooler-E9aetBe2w40-unsplash.jpg'
        };

        function setBackground(value) {
            if (value === 'none') {
                bgLayer.style.backgroundImage = '';
                bgLayer.classList.remove('active');
            } else {
                bgLayer.style.backgroundImage = `url('${bgImages[value]}')`;
                bgLayer.classList.add('active');
            }
            localStorage.setItem('breathBg', value);
        }

        // Random background on first visit, otherwise use saved preference
        if (!localStorage.getItem('breathBg')) {
            // First visit - start with random background
            const bgOptions = ['1', '2', '4'];
            currentBg = bgOptions[Math.floor(Math.random() * bgOptions.length)];
        }
        bgSelect.value = currentBg;
        setBackground(currentBg);

        bgSelect.addEventListener('change', (e) => {
            setBackground(e.target.value);
        });

        // Music controls
        radioAudio.loop = true;

        musicSelect.addEventListener('change', (e) => {
            const value = e.target.value;
            if (value === 'off') {
                radioAudio.pause();
                radioAudio.currentTime = 0;
                isPlaying = false;
                musicSelect.classList.remove('playing');
            } else {
                const trackIndex = parseInt(value);
                radioAudio.src = tracks[trackIndex];
                radioAudio.play().catch(err => console.log('Audio play failed:', err));
                isPlaying = true;
                musicSelect.classList.add('playing');
            }
        });

        radioAudio.addEventListener('error', () => {
            console.log('Track unavailable');
        });

        // ============================================
        // HAMBURGER MENU & MODALS
        // ============================================
        const menuDisclaimer = document.getElementById('menuDisclaimer');
        const menuScience = document.getElementById('menuScience');

        function openModal(modal) {
            modal.classList.remove('hidden');
            document.body.classList.add('modal-open');
            hamburgerMenu.classList.add('hidden');
        }

        function closeModal(modal) {
            modal.classList.add('hidden');
            document.body.classList.remove('modal-open');
        }

        function closeAllModals() {
            closeModal(disclaimerModal);
            closeModal(scienceModal);
        }

        // Hamburger menu toggle
        hamburgerBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            hamburgerMenu.classList.toggle('hidden');
        });

        // Close menu when clicking outside
        document.addEventListener('click', (e) => {
            if (!hamburgerMenu.contains(e.target) && e.target !== hamburgerBtn) {
                hamburgerMenu.classList.add('hidden');
            }
        });

        // Menu item handlers
        menuDisclaimer.addEventListener('click', () => {
            openModal(disclaimerModal);
        });

        menuScience.addEventListener('click', () => {
            openModal(scienceModal);
        });

        // Card overlay
        const menuCard = document.getElementById('menuCard');
        const cardCloseBtn = document.getElementById('cardCloseBtn');

        function showCard() {
            hamburgerMenu.classList.add('hidden');
            cardOverlay.classList.add('active');
        }

        function hideCard() {
            cardOverlay.classList.remove('active');
        }

        menuCard.addEventListener('click', showCard);
        cardCloseBtn.addEventListener('click', hideCard);

        // Click outside card to close
        cardOverlay.addEventListener('click', (e) => {
            if (e.target === cardOverlay) {
                hideCard();
            }
        });

        // Close buttons in modals
        document.querySelectorAll('.modal-close').forEach(btn => {
            btn.addEventListener('click', function() {
                const modal = this.closest('.modal-overlay');
                closeModal(modal);
            });
        });

        // Close modal on backdrop click
        [disclaimerModal, scienceModal].forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal(modal);
                }
            });
        });

        // Close modal on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeAllModals();
                hideCard();
                hamburgerMenu.classList.add('hidden');
            }
        });

        // ============================================
        // INITIALIZATION
        // ============================================
        createParticleOrb();
        updateParticleColors();
        colorCycle();
        setOrbScale(SCALE_MIN);
        startBreathing();
    </script>
</body>
</html>
