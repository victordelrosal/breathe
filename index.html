<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Breathe</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-color: #050508;
            --bg-gradient: radial-gradient(ellipse at 50% 0%, rgba(25, 25, 40, 0.5) 0%, transparent 50%),
                          radial-gradient(ellipse at 50% 100%, rgba(15, 20, 30, 0.3) 0%, transparent 40%),
                          linear-gradient(180deg, #080810 0%, #0a0a12 50%, #060608 100%);
            --nav-bg: rgba(15, 15, 25, 0.6);
            --nav-border: rgba(255, 255, 255, 0.06);
            --nav-glow: rgba(255, 255, 255, 0.02);
            --text-color: rgba(255, 255, 255, 0.87);
            --text-muted: rgba(255, 255, 255, 0.45);
            --border-color: rgba(255, 255, 255, 0.08);
            --control-bg: rgba(255, 255, 255, 0.03);
            --control-hover: rgba(255, 255, 255, 0.06);
        }

        [data-theme="light"] {
            --bg-color: #f8f8f6;
            --bg-gradient: radial-gradient(ellipse at 50% 0%, rgba(255, 255, 255, 0.8) 0%, transparent 50%),
                          radial-gradient(ellipse at 50% 100%, rgba(230, 230, 225, 0.5) 0%, transparent 40%),
                          linear-gradient(180deg, #fafaf8 0%, #f4f4f2 50%, #eeeee8 100%);
            --nav-bg: rgba(255, 255, 255, 0.7);
            --nav-border: rgba(0, 0, 0, 0.06);
            --nav-glow: rgba(255, 255, 255, 0.5);
            --text-color: rgba(20, 20, 30, 0.87);
            --text-muted: rgba(20, 20, 30, 0.45);
            --border-color: rgba(0, 0, 0, 0.08);
            --control-bg: rgba(0, 0, 0, 0.03);
            --control-hover: rgba(0, 0, 0, 0.06);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-gradient);
            background-color: var(--bg-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.5s ease;
            overflow: hidden;
        }

        /* Navbar - Premium Glassmorphism */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 14px 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--nav-bg);
            backdrop-filter: blur(40px) saturate(180%);
            -webkit-backdrop-filter: blur(40px) saturate(180%);
            border-bottom: 1px solid var(--nav-border);
            box-shadow:
                0 1px 0 0 var(--nav-glow) inset,
                0 4px 24px -8px rgba(0, 0, 0, 0.3);
            z-index: 100;
            opacity: 0.85;
            transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .navbar:hover {
            opacity: 1;
        }

        .nav-group {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        select, button {
            font-family: inherit;
            font-size: 13px;
            font-weight: 450;
            padding: 8px 14px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            background: var(--control-bg);
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            letter-spacing: 0.01em;
        }

        select:hover, button:hover {
            background: var(--control-hover);
            border-color: rgba(255, 255, 255, 0.12);
            transform: translateY(-1px);
        }

        select:active, button:active {
            transform: translateY(0);
        }

        select:focus, button:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.03);
        }

        select option {
            background: #1a1a24;
            color: var(--text-color);
            padding: 8px;
        }

        .theme-toggle {
            width: 38px;
            height: 38px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            border-radius: 12px;
        }

        .radio-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .radio-btn {
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .radio-btn.playing {
            background: rgba(120, 200, 160, 0.12);
            border-color: rgba(120, 200, 160, 0.25);
            box-shadow: 0 0 20px -5px rgba(120, 200, 160, 0.2);
        }

        .station-select {
            width: 100px;
        }

        .pattern-select {
            width: 110px;
        }

        .bg-select {
            width: 70px;
        }

        /* Background Image Layer */
        .bg-layer {
            position: fixed;
            inset: 0;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0;
            transition: opacity 0.5s ease;
            z-index: -1;
            pointer-events: none;
        }

        .bg-layer.active {
            opacity: 0.4;
        }

        [data-theme="light"] .bg-layer.active {
            opacity: 0.25;
        }

        /* Custom Pattern Panel */
        .custom-panel {
            position: fixed;
            top: 75px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--nav-bg);
            backdrop-filter: blur(40px) saturate(180%);
            -webkit-backdrop-filter: blur(40px) saturate(180%);
            border: 1px solid var(--nav-border);
            border-radius: 16px;
            padding: 18px 24px;
            z-index: 1000;
            box-shadow:
                0 1px 0 0 var(--nav-glow) inset,
                0 12px 40px -12px rgba(0, 0, 0, 0.4);
        }

        .custom-panel.hidden {
            display: none;
        }

        .custom-inputs {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .custom-inputs label {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-color);
            font-size: 13px;
            font-weight: 450;
            letter-spacing: 0.01em;
        }

        .custom-inputs input {
            width: 52px;
            padding: 8px 10px;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            background: var(--control-bg);
            color: var(--text-color);
            font-size: 14px;
            font-weight: 500;
            text-align: center;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .custom-inputs input:hover {
            background: var(--control-hover);
            border-color: rgba(255, 255, 255, 0.12);
        }

        .custom-inputs input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.03);
        }

        .custom-inputs .unit {
            color: var(--text-muted);
            font-size: 12px;
            font-weight: 400;
        }

        /* Orb Container */
        .orb-container {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 400px;
            height: 400px;
        }

        /* Particle Orb Wrapper - JS controls scale, CSS handles rotation only */
        .wrap {
            position: relative;
            width: 0;
            height: 0;
            transform-style: preserve-3d;
            perspective: 1000px;
            animation: rotate 20s infinite linear;
            transition: transform 0.1s linear;
        }

        @keyframes rotate {
            100% {
                transform: rotateY(360deg) rotateX(360deg);
            }
        }

        /* Individual particle */
        .c {
            position: absolute;
            width: 3px;
            height: 3px;
            border-radius: 50%;
            opacity: 0;
            box-shadow: 0 0 6px 1px currentColor;
        }

        /* Breathing text - classic cinema subtitle style (Helvetica, soft yellow, thin outline) */
        .breath-text {
            position: fixed;
            bottom: 5%;
            left: 50%;
            transform: translateX(-50%);
            font-family: Helvetica, 'Helvetica Neue', Arial, sans-serif;
            font-size: 42px;
            font-weight: 400;
            letter-spacing: 0.5px;
            color: #F8E473;
            text-align: center;
            text-shadow:
                1px 1px 0 #000,
                -1px 1px 0 #000,
                1px -1px 0 #000,
                -1px -1px 0 #000,
                0 1px 0 #000,
                0 -1px 0 #000,
                1px 0 0 #000,
                -1px 0 0 #000;
            z-index: 10;
            pointer-events: none;
            opacity: 1;
            transition: opacity 0.3s ease;
            max-width: 90%;
            line-height: 1.3;
            text-transform: uppercase;
        }

        .countdown {
            display: block;
            font-size: 28px;
            font-weight: 400;
            margin-top: 6px;
            letter-spacing: 1px;
            opacity: 0.9;
        }

        [data-theme="light"] .breath-text {
            color: #D4AF37;
            text-shadow:
                1px 1px 0 #000,
                -1px 1px 0 #000,
                1px -1px 0 #000,
                -1px -1px 0 #000,
                0 1px 0 #000,
                0 -1px 0 #000,
                1px 0 0 #000,
                -1px 0 0 #000;
        }

        /* Glow effect behind orb - JS controlled */
        .orb-glow {
            position: absolute;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: radial-gradient(circle,
                rgba(139, 92, 246, 0.3) 0%,
                rgba(6, 182, 212, 0.15) 40%,
                transparent 70%);
            filter: blur(40px);
            pointer-events: none;
            transition: transform 0.1s linear, opacity 0.1s linear;
        }

        [data-theme="light"] .orb-glow {
            opacity: 0.5;
        }

        /* Disclaimer Footer */
        .disclaimer-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 10px 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            font-size: 11px;
            color: var(--text-muted);
            opacity: 0.5;
            transition: opacity 0.3s ease;
            z-index: 50;
        }

        .disclaimer-footer:hover {
            opacity: 0.8;
        }

        .disclaimer-link {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 11px;
            padding: 2px 6px;
            cursor: pointer;
            opacity: 0.9;
            transition: opacity 0.2s ease;
        }

        .disclaimer-link:hover {
            opacity: 1;
            background: none;
            border: none;
            transform: none;
        }

        /* Modal Overlay */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        .modal-overlay.hidden {
            display: none;
        }

        .modal-content {
            background: var(--nav-bg);
            backdrop-filter: blur(40px) saturate(180%);
            -webkit-backdrop-filter: blur(40px) saturate(180%);
            border: 1px solid var(--nav-border);
            border-radius: 20px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 28px 32px;
            position: relative;
            box-shadow:
                0 1px 0 0 var(--nav-glow) inset,
                0 25px 80px -20px rgba(0, 0, 0, 0.5);
        }

        .modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--control-bg);
            border: 1px solid var(--border-color);
            color: var(--text-muted);
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            line-height: 1;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: var(--control-hover);
            color: var(--text-color);
        }

        .modal-content h2 {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 20px;
            letter-spacing: -0.01em;
        }

        .modal-body {
            font-size: 13px;
            line-height: 1.7;
            color: var(--text-muted);
        }

        .modal-body p {
            margin-bottom: 14px;
        }

        .modal-body strong {
            color: var(--text-color);
            font-weight: 600;
        }

        .modal-footer-text {
            margin-top: 20px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
            font-style: italic;
            opacity: 0.8;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .navbar {
                padding: 10px 16px;
                flex-wrap: wrap;
                gap: 10px;
            }

            .nav-group {
                gap: 8px;
            }

            select, button {
                font-size: 12px;
                padding: 6px 10px;
            }

            .station-select {
                width: 80px;
            }

            .pattern-select {
                width: 95px;
            }

            .bg-select {
                width: 60px;
            }

            .custom-panel {
                top: auto;
                bottom: auto;
                margin-top: 10px;
                position: relative;
                width: 100%;
                left: 0;
                transform: none;
                padding: 12px 16px;
            }

            .custom-inputs {
                gap: 12px;
                flex-wrap: wrap;
                justify-content: center;
            }

            .custom-inputs label {
                font-size: 12px;
            }

            .custom-inputs input {
                width: 45px;
                padding: 5px 6px;
                font-size: 13px;
            }

            .orb-container {
                width: 300px;
                height: 300px;
            }

            .breath-text {
                font-size: 22px;
                bottom: 6%;
            }

            .countdown {
                font-size: 18px;
            }

            .orb-glow {
                width: 220px;
                height: 220px;
            }

            .disclaimer-footer {
                font-size: 10px;
                padding: 8px 16px;
                flex-wrap: wrap;
                gap: 4px;
            }

            .disclaimer-link {
                font-size: 10px;
            }

            .modal-content {
                padding: 24px 20px;
                border-radius: 16px;
                max-height: 85vh;
            }

            .modal-content h2 {
                font-size: 16px;
            }

            .modal-body {
                font-size: 12px;
            }
        }
    </style>
</head>
<body data-theme="dark">
    <div id="bgLayer" class="bg-layer"></div>
    <nav class="navbar">
        <div class="nav-group">
            <select id="language" aria-label="Select language">
                <option value="en">English</option>
                <option value="zh">‰∏≠Êñá</option>
                <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
                <option value="es">Espa√±ol</option>
                <option value="fr">Fran√ßais</option>
                <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
                <option value="pt">Portugu√™s</option>
                <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                <option value="ja">Êó•Êú¨Ë™û</option>
                <option value="de">Deutsch</option>
                <option value="ko">ÌïúÍµ≠Ïñ¥</option>
                <option value="vi">Ti·∫øng Vi·ªát</option>
                <option value="tr">T√ºrk√ße</option>
                <option value="it">Italiano</option>
                <option value="th">‡πÑ‡∏ó‡∏¢</option>
                <option value="pl">Polski</option>
                <option value="nl">Nederlands</option>
                <option value="id">Indonesia</option>
                <option value="el">ŒïŒªŒªŒ∑ŒΩŒπŒ∫Œ¨</option>
                <option value="cs">ƒåe≈°tina</option>
                <option value="sv">Svenska</option>
                <option value="hu">Magyar</option>
                <option value="fi">Suomi</option>
                <option value="he">◊¢◊ë◊®◊ô◊™</option>
                <option value="uk">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
                <option value="ro">Rom√¢nƒÉ</option>
                <option value="ms">Bahasa Melayu</option>
                <option value="tl">Filipino</option>
                <option value="sw">Kiswahili</option>
                <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
                <option value="ur">ÿßÿ±ÿØŸà</option>
                <option value="fa">ŸÅÿßÿ±ÿ≥€å</option>
                <option value="mr">‡§Æ‡§∞‡§æ‡§†‡•Ä</option>
                <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
                <option value="pa">‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä</option>
                <option value="gu">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä</option>
                <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
                <option value="ml">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</option>
                <option value="my">·Äô·Äº·Äî·Ä∫·Äô·Ä¨</option>
                <option value="am">·ä†·àõ·à≠·äõ</option>
                <option value="ne">‡§®‡•á‡§™‡§æ‡§≤‡•Ä</option>
                <option value="si">‡∑É‡∑í‡∂Ç‡∑Ñ‡∂Ω</option>
                <option value="km">·ûó·û∂·ûü·û∂·ûÅ·üí·ûò·üÇ·ûö</option>
                <option value="lo">‡∫•‡∫≤‡∫ß</option>
                <option value="ka">·É•·Éê·É†·Éó·É£·Éö·Éò</option>
                <option value="az">Az…ôrbaycan</option>
                <option value="uz">O'zbek</option>
                <option value="kk">“ö–∞–∑–∞“õ</option>
                <option value="sr">–°—Ä–ø—Å–∫–∏</option>
            </select>
            <select id="pattern" class="pattern-select" aria-label="Select breathing pattern">
                <option value="gentle">Gentle 4-2-6</option>
                <option value="moderate" selected>Moderate 4-4-6</option>
                <option value="advanced">Advanced 4-7-8</option>
                <option value="custom">Custom</option>
            </select>
        </div>

        <div id="customPanel" class="custom-panel hidden">
            <div class="custom-inputs">
                <label>
                    <span>Inhale</span>
                    <input type="number" id="customInhale" min="1" max="30" value="4">
                    <span class="unit">s</span>
                </label>
                <label>
                    <span>Hold</span>
                    <input type="number" id="customHold" min="0" max="30" value="4">
                    <span class="unit">s</span>
                </label>
                <label>
                    <span>Exhale</span>
                    <input type="number" id="customExhale" min="1" max="30" value="6">
                    <span class="unit">s</span>
                </label>
            </div>
        </div>

        <div class="nav-group">
            <div class="radio-controls">
                <select id="station" class="station-select" aria-label="Select music track">
                    <option value="0">Peaceful</option>
                    <option value="1">Soothing</option>
                    <option value="2">Tranquil Garden</option>
                    <option value="3">Ambient</option>
                </select>
                <button id="radioBtn" class="radio-btn" aria-label="Play/Stop music">
                    <span id="radioIcon">‚ñ∂</span>
                    <span id="radioText">Play</span>
                </button>
            </div>
            <select id="bgSelect" class="bg-select" aria-label="Select background">
                <option value="none">No BG</option>
                <option value="1">BG 1</option>
                <option value="2">BG 2</option>
                <option value="3">BG 3</option>
                <option value="4">BG 4</option>
            </select>
            <button id="silentToggle" class="theme-toggle" aria-label="Toggle silent mode" title="Silent mode">üí¨</button>
            <button id="themeToggle" class="theme-toggle" aria-label="Toggle theme">‚òÄ</button>
        </div>
    </nav>

    <div class="orb-container">
        <div class="orb-glow" id="orbGlow"></div>
        <div class="wrap" id="wrap"></div>
    </div>

    <div class="breath-text" id="breathText">
        <span id="phaseText">Breathe In</span>
        <span class="countdown" id="countdown">4</span>
    </div>

    <audio id="radioAudio" preload="none"></audio>

    <!-- Disclaimer Footer -->
    <footer class="disclaimer-footer">
        <span>Not medical advice. Use at your own risk.</span>
        <button id="disclaimerBtn" class="disclaimer-link" aria-label="View full disclaimer">‚ÑπÔ∏è Full disclaimer</button>
    </footer>

    <!-- Disclaimer Modal -->
    <div id="disclaimerModal" class="modal-overlay hidden">
        <div class="modal-content">
            <button id="modalClose" class="modal-close" aria-label="Close disclaimer">&times;</button>
            <h2>Disclaimer & Waiver</h2>
            <div class="modal-body">
                <p>This breathing exercise application ("Breathe") is provided for relaxation and general wellness purposes only. It does not constitute medical advice, diagnosis, or treatment, and is not a substitute for professional healthcare.</p>

                <p><strong>ASSUMPTION OF RISK:</strong> By using this application, you acknowledge that breathing exercises carry inherent risks including but not limited to dizziness, hyperventilation, lightheadedness, fainting, tingling, anxiety, and in rare cases, more serious adverse effects. You voluntarily assume all risks associated with use.</p>

                <p><strong>STOP IMMEDIATELY</strong> if you experience dizziness, chest pain, shortness of breath, tingling, nausea, or any discomfort.</p>

                <p><strong>DO NOT USE</strong> while driving, operating machinery, in water, or in any situation where impaired consciousness could be dangerous.</p>

                <p><strong>CONSULT A PHYSICIAN</strong> before use if you are pregnant, have cardiovascular disease, respiratory conditions, low or high blood pressure, a history of fainting, panic disorder, epilepsy, or any other medical condition.</p>

                <p><strong>LIMITATION OF LIABILITY:</strong> To the fullest extent permitted by law, the creators, developers, and distributors of this application shall not be held liable for any direct, indirect, incidental, consequential, or punitive damages arising from your use of this application. This includes, without limitation, any injury, illness, or adverse health effect.</p>

                <p><strong>NO WARRANTY:</strong> This application is provided "as is" without warranties of any kind, express or implied, including fitness for a particular purpose.</p>

                <p><strong>INDEMNIFICATION:</strong> You agree to indemnify and hold harmless the creators and distributors of this application from any claims, damages, or expenses arising from your use.</p>

                <p class="modal-footer-text">By continuing to use this application, you confirm that you have read, understood, and agree to this disclaimer.</p>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // PARTICLE ORB CONFIGURATION
        // ============================================
        const TOTAL_PARTICLES = 250;
        const ORB_SIZE = 100;
        const PARTICLE_TIME = 14;
        let baseHue = 270;

        // Scale bounds
        const SCALE_MIN = 0.5;
        const SCALE_MAX = 1.8;

        // ============================================
        // BREATHING PATTERNS
        // ============================================
        const patterns = {
            gentle: [
                { key: 'in', ms: 4000 },
                { key: 'hold', ms: 2000 },
                { key: 'out', ms: 6000 }
            ],
            moderate: [
                { key: 'in', ms: 4000 },
                { key: 'hold', ms: 4000 },
                { key: 'out', ms: 6000 }
            ],
            advanced: [
                { key: 'in', ms: 4000 },
                { key: 'hold', ms: 7000 },
                { key: 'out', ms: 8000 }
            ]
        };

        // ============================================
        // TRANSLATIONS (50 languages with hold)
        // ============================================
        const translations = {
            en: { in: 'Breathe In', hold: 'Hold', out: 'Breathe Out' },
            zh: { in: 'Âê∏Ê∞î', hold: 'Â±èÊÅØ', out: 'ÂëºÊ∞î' },
            hi: { in: '‡§∏‡§æ‡§Ç‡§∏ ‡§≤‡•á‡§Ç', hold: '‡§∞‡•ã‡§ï‡•á‡§Ç', out: '‡§∏‡§æ‡§Ç‡§∏ ‡§õ‡•ã‡§°‡§º‡•á‡§Ç' },
            es: { in: 'Inhala', hold: 'Mant√©n', out: 'Exhala' },
            fr: { in: 'Inspirez', hold: 'Retenez', out: 'Expirez' },
            ar: { in: 'ÿßÿ≥ÿ™ŸÜÿ¥ŸÇ', hold: 'ÿßÿ≠ÿ®ÿ≥', out: 'ÿßÿ≤ŸÅÿ±' },
            bn: { in: '‡¶∂‡ßç‡¶¨‡¶æ‡¶∏ ‡¶®‡¶ø‡¶®', hold: '‡¶ß‡¶∞‡ßÅ‡¶®', out: '‡¶∂‡ßç‡¶¨‡¶æ‡¶∏ ‡¶õ‡¶æ‡¶°‡¶º‡ßÅ‡¶®' },
            pt: { in: 'Inspire', hold: 'Segure', out: 'Expire' },
            ru: { in: '–í–¥–æ—Ö', hold: '–ó–∞–¥–µ—Ä–∂–∫–∞', out: '–í—ã–¥–æ—Ö' },
            ja: { in: 'Âê∏„Å£„Å¶', hold: 'Ê≠¢„ÇÅ„Å¶', out: 'Âêê„ÅÑ„Å¶' },
            de: { in: 'Einatmen', hold: 'Halten', out: 'Ausatmen' },
            ko: { in: 'Îì§Ïù¥Ïâ¨ÏÑ∏Ïöî', hold: 'Î©àÏ∂îÏÑ∏Ïöî', out: 'ÎÇ¥Ïâ¨ÏÑ∏Ïöî' },
            vi: { in: 'H√≠t v√†o', hold: 'Gi·ªØ', out: 'Th·ªü ra' },
            tr: { in: 'Nefes Al', hold: 'Tut', out: 'Nefes Ver' },
            it: { in: 'Inspira', hold: 'Trattieni', out: 'Espira' },
            th: { in: '‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡πÄ‡∏Ç‡πâ‡∏≤', hold: '‡∏Å‡∏•‡∏±‡πâ‡∏ô', out: '‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏≠‡∏≠‡∏Å' },
            pl: { in: 'Wdech', hold: 'Zatrzymaj', out: 'Wydech' },
            nl: { in: 'Inademen', hold: 'Vasthouden', out: 'Uitademen' },
            id: { in: 'Tarik Napas', hold: 'Tahan', out: 'Hembuskan' },
            el: { in: 'ŒïŒπœÉœÄŒΩŒøŒÆ', hold: 'ŒöœÅŒ¨œÑŒ±', out: 'ŒïŒ∫œÄŒΩŒøŒÆ' },
            cs: { in: 'N√°dech', hold: 'Zadr≈æet', out: 'V√Ωdech' },
            sv: { in: 'Andas in', hold: 'H√•ll', out: 'Andas ut' },
            hu: { in: 'L√©legezz be', hold: 'Tartsd', out: 'L√©legezz ki' },
            fi: { in: 'Hengit√§ sis√§√§n', hold: 'Pid√§t√§', out: 'Hengit√§ ulos' },
            he: { in: '◊©◊ê◊ô◊§◊î', hold: '◊î◊ó◊ñ◊ß', out: '◊†◊©◊ô◊§◊î' },
            uk: { in: '–í–¥–∏—Ö', hold: '–ó–∞—Ç—Ä–∏–º–∫–∞', out: '–í–∏–¥–∏—Ö' },
            ro: { in: 'InspirƒÉ', hold: '»öine', out: 'ExpirƒÉ' },
            ms: { in: 'Tarik Nafas', hold: 'Tahan', out: 'Hembus' },
            tl: { in: 'Huminga', hold: 'Hawakan', out: 'Ilabas' },
            sw: { in: 'Vuta Pumzi', hold: 'Shika', out: 'Toa Pumzi' },
            ta: { in: '‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æ¥‡ØÅ', hold: '‡Æ®‡Æø‡Æ±‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ', out: '‡Æµ‡ØÜ‡Æ≥‡Æø‡ÆØ‡Æø‡Æü‡ØÅ' },
            ur: { in: 'ÿ≥ÿßŸÜÿ≥ ŸÑ€å⁄∫', hold: 'ÿ±Ÿà⁄©€å⁄∫', out: 'ÿ≥ÿßŸÜÿ≥ ⁄Ü⁄æŸà⁄ë€å⁄∫' },
            fa: { in: 'ÿØŸÖ', hold: 'ŸÜ⁄ØŸá ÿØÿßÿ±', out: 'ÿ®ÿßÿ≤ÿØŸÖ' },
            mr: { in: '‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§ò‡•ç‡§Ø‡§æ', hold: '‡§ß‡§∞‡§æ', out: '‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§∏‡•ã‡§°‡§æ' },
            te: { in: '‡∞™‡±Ä‡∞≤‡±ç‡∞ö‡±Å', hold: '‡∞Ü‡∞™‡±Å', out: '‡∞µ‡∞¶‡±Å‡∞≤‡±Å' },
            pa: { in: '‡®∏‡®æ‡®π ‡®≤‡®ì', hold: '‡®∞‡©ã‡®ï‡©ã', out: '‡®∏‡®æ‡®π ‡®õ‡©±‡®°‡©ã' },
            gu: { in: '‡™∂‡´ç‡™µ‡™æ‡™∏ ‡™≤‡´ã', hold: '‡™∞‡´ã‡™ï‡´ã', out: '‡™∂‡´ç‡™µ‡™æ‡™∏ ‡™õ‡´ã‡™°‡´ã' },
            kn: { in: '‡≤â‡≤∏‡≤ø‡≤∞‡≥Å', hold: '‡≤π‡≤ø‡≤°‡≤ø', out: '‡≤¨‡≤ø‡≤°‡≥Å' },
            ml: { in: '‡¥∂‡µç‡¥µ‡¥∏‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï', hold: '‡¥™‡¥ø‡¥ü‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï', out: '‡¥™‡µÅ‡¥±‡¥§‡µç‡¥§‡µÅ‡¥µ‡¥ø‡¥ü‡µÅ‡¥ï' },
            my: { in: '·Äõ·Äæ·Ä∞', hold: '·Äë·Ä≠·Äî·Ä∫·Ä∏', out: '·Äë·ÄØ·Äê·Ä∫' },
            am: { in: '·â∞·äê·çç·àµ', hold: '·ã´·ãù', out: '·ä†·ãç·å£' },
            ne: { in: '‡§∏‡§æ‡§∏ ‡§≤‡§ø‡§®‡•Å', hold: '‡§∞‡•ã‡§ï‡•ç‡§®‡•Å', out: '‡§∏‡§æ‡§∏ ‡§õ‡•ã‡§°‡•ç‡§®‡•Å' },
            si: { in: '‡∑Ñ‡∑î‡∑É‡∑ä‡∂∏ ‡∂ú‡∂±‡∑ä‡∂±', hold: '‡∂ª‡∂≥‡∑Ä‡∂±‡∑ä‡∂±', out: '‡∑Ñ‡∑î‡∑É‡∑ä‡∂∏ ‡∑Ñ‡∂ª‡∑í‡∂±‡∑ä‡∂±' },
            km: { in: '·ûä·ûÄ·ûä·ûÑ·üí·û†·ûæ·ûò·ûÖ·ûº·ûõ', hold: '·ûÄ·û∂·ûì·üã', out: '·ûä·ûÄ·ûä·ûÑ·üí·û†·ûæ·ûò·ûÖ·üÅ·ûâ' },
            lo: { in: '‡∫´‡∫≤‡∫ç‡ªÉ‡∫à‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤', hold: '‡∫ñ‡∫∑', out: '‡∫´‡∫≤‡∫ç‡ªÉ‡∫à‡∫≠‡∫≠‡∫Å' },
            ka: { in: '·É©·Éê·Éò·É°·É£·Éú·Éó·É•·Éî', hold: '·É®·Éî·Éê·É©·Éî·É†·Éî', out: '·Éê·Éõ·Éù·Éò·É°·É£·Éú·Éó·É•·Éî' },
            az: { in: 'N…ôf…ôs al', hold: 'Saxla', out: 'N…ôf…ôs ver' },
            uz: { in: 'Nafas ol', hold: 'Ushla', out: 'Nafas chiqar' },
            kk: { in: '–î–µ–º –∞–ª', hold: '“∞—Å—Ç–∞', out: '–î–µ–º —à—ã“ì–∞—Ä' },
            sr: { in: '–£–¥–∞—Ö–Ω–∏', hold: '–ó–∞–¥—Ä–∂–∏', out: '–ò–∑–¥–∞—Ö–Ω–∏' }
        };

        // ============================================
        // LOCAL MUSIC TRACKS
        // ============================================
        const tracks = [
            'music/relax-meditate-gentle-peaceful-291162.mp3',
            'music/soothing-meditation-without-voice-315921.mp3',
            'music/zen-garden-310599.mp3',
            'music/zen-spiritual-yoga-massage-meditation-spa-relax-ambient-music-18403.mp3'
        ];

        // ============================================
        // DOM ELEMENTS
        // ============================================
        const wrap = document.getElementById('wrap');
        const orbGlow = document.getElementById('orbGlow');
        const breathText = document.getElementById('breathText');
        const phaseText = document.getElementById('phaseText');
        const countdownEl = document.getElementById('countdown');
        const languageSelect = document.getElementById('language');
        const patternSelect = document.getElementById('pattern');
        const themeToggle = document.getElementById('themeToggle');
        const silentToggle = document.getElementById('silentToggle');
        const radioBtn = document.getElementById('radioBtn');
        const radioIcon = document.getElementById('radioIcon');
        const radioText = document.getElementById('radioText');
        const stationSelect = document.getElementById('station');
        const radioAudio = document.getElementById('radioAudio');
        const customPanel = document.getElementById('customPanel');
        const customInhale = document.getElementById('customInhale');
        const customHold = document.getElementById('customHold');
        const customExhale = document.getElementById('customExhale');
        const disclaimerBtn = document.getElementById('disclaimerBtn');
        const disclaimerModal = document.getElementById('disclaimerModal');
        const modalClose = document.getElementById('modalClose');
        const bgSelect = document.getElementById('bgSelect');
        const bgLayer = document.getElementById('bgLayer');

        // ============================================
        // STATE
        // ============================================
        let currentLang = 'en';
        let currentPattern = localStorage.getItem('breathPattern') || 'moderate';
        let pendingPattern = null; // Pattern to apply at next cycle
        let currentBg = localStorage.getItem('breathBg') || 'none';

        // Load custom pattern values from localStorage
        const savedCustom = JSON.parse(localStorage.getItem('customBreathPattern') || '{"inhale":4,"hold":4,"exhale":6}');
        customInhale.value = savedCustom.inhale;
        customHold.value = savedCustom.hold;
        customExhale.value = savedCustom.exhale;
        let silentMode = localStorage.getItem('silentMode') === 'true';
        let isPlaying = false;

        // Animation state
        let currentPhaseIndex = 0;
        let phaseStartTime = 0;
        let animationFrameId = null;
        let currentScale = SCALE_MIN;

        // Initialize pattern dropdown
        patternSelect.value = currentPattern;
        // Show custom panel if custom pattern was saved
        if (currentPattern === 'custom') {
            customPanel.classList.remove('hidden');
        }

        // ============================================
        // PARTICLE ORB CREATION
        // ============================================
        function createParticleOrb() {
            const styleSheet = document.createElement('style');
            let css = '';

            for (let i = 1; i <= TOTAL_PARTICLES; i++) {
                const particle = document.createElement('div');
                particle.className = 'c';
                particle.id = `p${i}`;
                wrap.appendChild(particle);

                const z = Math.random() * 360;
                const y = Math.random() * 360;

                css += `
                    .c:nth-child(${i}) {
                        animation: orbit${i} ${PARTICLE_TIME}s infinite;
                        animation-delay: ${i * 0.01}s;
                    }
                    @keyframes orbit${i} {
                        0% {
                            opacity: 0;
                            transform: rotateZ(${-z}deg) rotateY(${y}deg) translateX(0) rotateZ(${z}deg);
                        }
                        15% {
                            opacity: 1;
                            transform: rotateZ(${-z}deg) rotateY(${y}deg) translateX(${ORB_SIZE}px) rotateZ(${z}deg);
                        }
                        100% {
                            opacity: 1;
                            transform: rotateZ(${-z}deg) rotateY(${y}deg) translateX(${ORB_SIZE}px) rotateZ(${z}deg);
                        }
                    }
                `;
            }

            styleSheet.textContent = css;
            document.head.appendChild(styleSheet);
        }

        // ============================================
        // COLOR CYCLING
        // ============================================
        function updateParticleColors() {
            const particles = document.querySelectorAll('.c');
            particles.forEach((particle, i) => {
                const hue = (baseHue + (40 / TOTAL_PARTICLES) * i) % 360;
                particle.style.color = `hsl(${hue}, 100%, 60%)`;
                particle.style.backgroundColor = `hsl(${hue}, 100%, 60%)`;
            });

            const hue1 = baseHue;
            const hue2 = (baseHue + 60) % 360;
            orbGlow.style.background = `radial-gradient(circle,
                hsla(${hue1}, 80%, 50%, 0.3) 0%,
                hsla(${hue2}, 80%, 50%, 0.15) 40%,
                transparent 70%)`;
        }

        function colorCycle() {
            baseHue = (baseHue + 0.3) % 360;
            updateParticleColors();
            requestAnimationFrame(colorCycle);
        }

        // ============================================
        // ORB SCALE ANIMATION (JS-driven)
        // ============================================
        function setOrbScale(scale) {
            currentScale = scale;
            wrap.style.scale = scale;
            // Glow follows orb scale with slight amplification
            const glowScale = 0.5 + (scale - SCALE_MIN) / (SCALE_MAX - SCALE_MIN) * 1.5;
            const glowOpacity = 0.4 + (scale - SCALE_MIN) / (SCALE_MAX - SCALE_MIN) * 0.5;
            orbGlow.style.transform = `scale(${glowScale})`;
            orbGlow.style.opacity = glowOpacity;
        }

        // Easing function for smooth transitions
        function easeInOutQuad(t) {
            return t < 0.5 ? 2 * t * t : 1 - Math.pow(-2 * t + 2, 2) / 2;
        }

        // ============================================
        // TEXT & COUNTDOWN DISPLAY
        // ============================================
        function getPhaseLabel(key) {
            const t = translations[currentLang] || translations.en;
            return t[key] || translations.en[key];
        }

        function updateDisplay(phaseKey, secondsRemaining) {
            if (!silentMode) {
                phaseText.textContent = getPhaseLabel(phaseKey);
                countdownEl.textContent = secondsRemaining;
            }
        }

        function updateSilentModeUI() {
            if (silentMode) {
                breathText.style.opacity = '0';
                silentToggle.textContent = 'üîá';
                silentToggle.title = 'Silent mode (on)';
            } else {
                breathText.style.opacity = '0.95';
                silentToggle.textContent = 'üí¨';
                silentToggle.title = 'Silent mode (off)';
            }
        }

        // ============================================
        // BREATHING SCHEDULER
        // ============================================
        function getPattern() {
            if (currentPattern === 'custom') {
                return [
                    { key: 'in', ms: parseInt(customInhale.value) * 1000 || 4000 },
                    { key: 'hold', ms: parseInt(customHold.value) * 1000 || 0 },
                    { key: 'out', ms: parseInt(customExhale.value) * 1000 || 6000 }
                ].filter(phase => phase.ms > 0); // Remove hold if 0
            }
            return patterns[currentPattern];
        }

        function startPhase(phaseIndex) {
            const pattern = getPattern();
            currentPhaseIndex = phaseIndex % pattern.length;
            phaseStartTime = performance.now();

            // If starting a new cycle (phase 0), check for pending pattern change
            if (currentPhaseIndex === 0 && pendingPattern) {
                currentPattern = pendingPattern;
                pendingPattern = null;
                localStorage.setItem('breathPattern', currentPattern);
            }
        }

        function breathingLoop(timestamp) {
            const pattern = getPattern();
            const phase = pattern[currentPhaseIndex];
            const elapsed = timestamp - phaseStartTime;
            const progress = Math.min(elapsed / phase.ms, 1);
            const easedProgress = easeInOutQuad(progress);

            // Calculate seconds remaining (update at least every 250ms means we show whole seconds)
            const msRemaining = Math.max(0, phase.ms - elapsed);
            const secondsRemaining = Math.ceil(msRemaining / 1000);

            // Update orb scale based on phase
            if (phase.key === 'in') {
                // Inhale: scale from MIN to MAX
                const scale = SCALE_MIN + (SCALE_MAX - SCALE_MIN) * easedProgress;
                setOrbScale(scale);
            } else if (phase.key === 'hold') {
                // Hold: stay at MAX with very subtle 1.5% pulse at 0.4Hz
                const pulsePhase = (elapsed / 1000) * Math.PI * 0.8; // 0.4Hz = slower, calmer
                const pulse = Math.sin(pulsePhase) * 0.015; // ¬±1.5% - barely perceptible
                setOrbScale(SCALE_MAX * (1 + pulse));
            } else if (phase.key === 'out') {
                // Exhale: scale from MAX to MIN
                const scale = SCALE_MAX - (SCALE_MAX - SCALE_MIN) * easedProgress;
                setOrbScale(scale);
            }

            // Update display
            updateDisplay(phase.key, secondsRemaining);

            // Check if phase is complete
            if (progress >= 1) {
                startPhase(currentPhaseIndex + 1);
            }

            animationFrameId = requestAnimationFrame(breathingLoop);
        }

        function startBreathing() {
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
            }
            startPhase(0);
            animationFrameId = requestAnimationFrame(breathingLoop);
        }

        // ============================================
        // EVENT HANDLERS
        // ============================================
        languageSelect.addEventListener('change', (e) => {
            currentLang = e.target.value;
        });

        patternSelect.addEventListener('change', (e) => {
            // Queue pattern change for next cycle start
            pendingPattern = e.target.value;
            // Show/hide custom panel
            if (e.target.value === 'custom') {
                customPanel.classList.remove('hidden');
            } else {
                customPanel.classList.add('hidden');
            }
        });

        // Custom pattern inputs - save to localStorage on change
        function saveCustomPattern() {
            const custom = {
                inhale: parseInt(customInhale.value) || 4,
                hold: parseInt(customHold.value) || 0,
                exhale: parseInt(customExhale.value) || 6
            };
            localStorage.setItem('customBreathPattern', JSON.stringify(custom));
        }

        customInhale.addEventListener('change', saveCustomPattern);
        customHold.addEventListener('change', saveCustomPattern);
        customExhale.addEventListener('change', saveCustomPattern);

        silentToggle.addEventListener('click', () => {
            silentMode = !silentMode;
            localStorage.setItem('silentMode', silentMode);
            updateSilentModeUI();
        });

        themeToggle.addEventListener('click', () => {
            const body = document.body;
            const isDark = body.getAttribute('data-theme') === 'dark';
            body.setAttribute('data-theme', isDark ? 'light' : 'dark');
            themeToggle.textContent = isDark ? '‚òæ' : '‚òÄ';
        });

        // Background selection
        function setBackground(value) {
            if (value === 'none') {
                bgLayer.style.backgroundImage = '';
                bgLayer.classList.remove('active');
            } else {
                bgLayer.style.backgroundImage = `url('backgr/backgr0${value}.png')`;
                bgLayer.classList.add('active');
            }
            localStorage.setItem('breathBg', value);
        }

        bgSelect.value = currentBg;
        setBackground(currentBg);

        bgSelect.addEventListener('change', (e) => {
            setBackground(e.target.value);
        });

        // Music controls
        radioAudio.loop = true;

        function toggleMusic() {
            if (isPlaying) {
                radioAudio.pause();
                radioAudio.currentTime = 0;
                isPlaying = false;
                radioIcon.textContent = '‚ñ∂';
                radioText.textContent = 'Play';
                radioBtn.classList.remove('playing');
            } else {
                const trackIndex = parseInt(stationSelect.value);
                radioAudio.src = tracks[trackIndex];
                radioAudio.play().catch(e => console.log('Audio play failed:', e));
                isPlaying = true;
                radioIcon.textContent = '‚ñ†';
                radioText.textContent = 'Stop';
                radioBtn.classList.add('playing');
            }
        }

        radioBtn.addEventListener('click', toggleMusic);

        stationSelect.addEventListener('change', () => {
            if (isPlaying) {
                const trackIndex = parseInt(stationSelect.value);
                radioAudio.src = tracks[trackIndex];
                radioAudio.play().catch(e => console.log('Audio play failed:', e));
            }
        });

        radioAudio.addEventListener('error', () => {
            console.log('Track unavailable');
        });

        // Disclaimer modal handlers
        disclaimerBtn.addEventListener('click', () => {
            disclaimerModal.classList.remove('hidden');
        });

        modalClose.addEventListener('click', () => {
            disclaimerModal.classList.add('hidden');
        });

        disclaimerModal.addEventListener('click', (e) => {
            if (e.target === disclaimerModal) {
                disclaimerModal.classList.add('hidden');
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !disclaimerModal.classList.contains('hidden')) {
                disclaimerModal.classList.add('hidden');
            }
        });

        // ============================================
        // INITIALIZATION
        // ============================================
        createParticleOrb();
        updateParticleColors();
        colorCycle();
        updateSilentModeUI();
        setOrbScale(SCALE_MIN);
        startBreathing();
    </script>
</body>
</html>
